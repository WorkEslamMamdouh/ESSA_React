<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ø´Ø¬Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</title>
    <style>
        ul {
            list-style-type: none;
            padding-left: 20px;
        }

        .node {
            margin: 5px 0;
        }

        .expand-btn {
            cursor: pointer;
            color: blue;
            margin-right: 5px;
        }

        .loading {
            color: gray;
            font-size: 12px;
        }
    </style>
</head>
<body>

    <h2>ðŸŒ³ Ø´Ø¬Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</h2>
    <div id="tree-container">
        <ul id="1-null"></ul> <!-- ðŸ‘ˆ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ø¶Ø±ÙˆØ±ÙŠ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø°Ø± -->
    </div>


    <script>
        const pageSize = 5;

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡ Ù…Ù† API
        async function loadChildren(compCode, parentAcc, page = 1) {

            debugger
            const containerId = `${compCode}-${parentAcc}`;
            const container = document.getElementById(containerId);

            if (!container) return;

            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„"
            const loadingMsg = document.createElement('div');
            loadingMsg.textContent = '...Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„';
            loadingMsg.className = 'loading';
            container.appendChild(loadingMsg);

            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ API (ÙŠÙØªØ±Ø¶ Ø£Ù†Ùƒ Ø³ØªØºÙŠØ± Ù‡Ø°Ø§ Ø¨Ù€ fetch ÙØ¹Ù„ÙŠ Ù„Ø§Ø­Ù‚Ù‹Ø§)
            const data = await mockApi(compCode, parentAcc, page);

            container.removeChild(loadingMsg);

            // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡
            data.items.forEach(item => {
                const li = document.createElement('li');
                li.className = 'node';
                li.textContent = item.ACC_DESCA;

                if (item.DETAIL === 0) {
                    // Ù„Ø¯ÙŠÙ‡ Ø£Ø¨Ù†Ø§Ø¡
                    const expandBtn = document.createElement('span');
                    expandBtn.textContent = 'âž•';
                    expandBtn.className = 'expand-btn';
                    expandBtn.onclick = () => toggleNode(item.COMP_CODE, item.ACC_CODE, li);
                    li.prepend(expandBtn);
                }

                const childUl = document.createElement('ul');
                childUl.id = `${item.COMP_CODE}-${item.ACC_CODE}`;
                li.appendChild(childUl);
                container.appendChild(li);
            });

            // Ø²Ø± "ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯"
            if (data.hasMore) {
                const moreBtn = document.createElement('button');
                moreBtn.textContent = 'ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯';
                moreBtn.onclick = () => {
                    container.removeChild(moreBtn);
                    loadChildren(compCode, parentAcc, page + 1);
                };
                container.appendChild(moreBtn);
            }
        }

        // ØªÙˆØ³ÙŠØ¹ Ø¹Ù‚Ø¯Ø©
        function toggleNode(compCode, accCode, nodeElement) {
            const ul = nodeElement.querySelector('ul');
            const expandBtn = nodeElement.querySelector('.expand-btn');

            if (ul.childElementCount === 0) {
                // Ø£ÙˆÙ„ Ù…Ø±Ø© â€“ Ø­Ù…Ù‘Ù„ Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡
                loadChildren(compCode, accCode).then(() => {
                    expandBtn.textContent = 'âž–';
                });
            } else {
                if (ul.style.display === 'none') {
                    ul.style.display = 'block';
                    expandBtn.textContent = 'âž–';
                } else {
                    ul.style.display = 'none';
                    expandBtn.textContent = 'âž•';
                }
            }
        }


        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø°Ø±
        loadChildren(1, null);

        // API ÙˆÙ‡Ù…ÙŠ - Ø§Ø³ØªØ¨Ø¯Ù„Ù‡ Ø¨Ù€ fetch Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
        async function mockApi(compCode, parentAcc, page) {
            debugger
            const all = [
                { COMP_CODE: 1, ACC_CODE: "1", ACC_DESCA: "Ø§Ù„Ø£ØµÙˆÙ„", DETAIL: 0, PARENT_ACC: null },
                { COMP_CODE: 1, ACC_CODE: "11", ACC_DESCA: "Ø§Ù„Ø§ØµÙˆÙ„ Ø§Ù„Ù…ØªØ¯Ø§ÙˆÙ„Ø©", DETAIL: 0, PARENT_ACC: "1" },
                { COMP_CODE: 1, ACC_CODE: "1101", ACC_DESCA: "Ø§Ù„Ø®Ø²Ù†Ù‡", DETAIL: 0, PARENT_ACC: "11" },
                { COMP_CODE: 1, ACC_CODE: "110101", ACC_DESCA: "Ø§Ù„Ø®Ø²ÙŠÙ†Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", DETAIL: 1, PARENT_ACC: "1101" },
                { COMP_CODE: 1, ACC_CODE: "1102", ACC_DESCA: "Ø§Ù„Ø¨Ù†ÙˆÙƒ", DETAIL: 1, PARENT_ACC: "11" },
                { COMP_CODE: 1, ACC_CODE: "1103", ACC_DESCA: "Ø¹Ù…Ù„Ø§Ø¡", DETAIL: 1, PARENT_ACC: "11" },
                { COMP_CODE: 1, ACC_CODE: "1104", ACC_DESCA: "Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†", DETAIL: 1, PARENT_ACC: "11" },
                { COMP_CODE: 1, ACC_CODE: "1105", ACC_DESCA: "Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†", DETAIL: 0, PARENT_ACC: "11" },
                { COMP_CODE: 1, ACC_CODE: "110501", ACC_DESCA: "Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†", DETAIL: 0, PARENT_ACC: "1105" },
                { COMP_CODE: 1, ACC_CODE: "1105010001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110501" },
                { COMP_CODE: 1, ACC_CODE: "110502", ACC_DESCA: "Ø¹Ù‡Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†", DETAIL: 0, PARENT_ACC: "1105" },
                { COMP_CODE: 1, ACC_CODE: "1105020001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110502" },
                { COMP_CODE: 1, ACC_CODE: "110503", ACC_DESCA: "Ø³Ù„Ù Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†", DETAIL: 0, PARENT_ACC: "1105" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
                { COMP_CODE: 1, ACC_CODE: "1105030001", ACC_DESCA: "Ragab", DETAIL: 1, PARENT_ACC: "110503" },
            ];

            const filtered = all.filter(item => item.COMP_CODE == compCode && item.PARENT_ACC == parentAcc);
            const start = (page - 1) * pageSize;
            const items = filtered.slice(start, start + pageSize);
            const hasMore = start + pageSize < filtered.length;

            await new Promise(resolve => setTimeout(resolve, 300)); // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ£Ø®ÙŠØ±
            return { items, hasMore };
        }
    </script>

</body>
</html>
